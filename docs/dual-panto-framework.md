# DualPanto Framework

This contains the API documentation of the main framework.

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [DualPantoFramework][1]
-   [Broker][2]
    -   [run_script][3]
    -   [waitMS][4]
    -   [devices][5]
-   [Device][6]
    -   [send][7]
    -   [getMePosition][8]
    -   [getItPosition][9]
    -   [createObstacle][10]
    -   [removeObstacle][11]
    -   [moveHandleTo][12]
    -   [applyForceTo][13]
    -   [movePantoTo][14]
    -   [unblockHandle][15]
    -   [step][16]
    -   [speakText][17]
    -   [onKeyword][18]
    -   [onceKeyword][19]
    -   [offKeyword][20]
    -   [emitKeyword][21]
-   [Player][22]
    -   [then][23]
    -   [play][24]
    -   [pause][25]
    -   [stop][26]
-   [VoiceInteraction][27]
    -   [speakText][28]
    -   [playSound][29]
    -   [setCommands][30]
    -   [beginListening][31]
    -   [haltListening][32]
-   [util][33]
    -   [delay][34]

## DualPantoFramework

The dual panto framework. All classes and [utility][33] functions are exported.
This also includes the [geometry][35] classes (e.g. [Vector][36]).

**Examples**

```javascript
const {Broker, Vector, delay} = require('dualpantoframework');

const broker = new Broker();

broker.on('device', async device => {
    await delay(500);
    await device.movePantoTo(0, new Vector(20, -30, 0));
    await device.speakText('Hallo Welt!');
})
```

## Broker

**Extends EventEmitter**

Class for device handling and basic functions

**Parameters**

-   `options` **[Object][37]?** broker options (optional, default `{}`)

**Properties**

-   `devices` **[Map][38]&lt;[string][39], [Device][40]>** map of connected devices
-   `disconnectTimeout` **[number][41]** timeout after which a device gets disconnected

### run_script

Creates a script that executes a list of promises.

**Parameters**

-   `promiseList` **[array][42]** the list of promises to execute

**Examples**

```javascript
// OLD: run_script syntax:
device.on('handleMoved', (index, position) => {
    run_script([
        () => device.movePantoTo(0, new Vector(1, 2, 0)),
        () => DualPantoFramework.waitMS(500),
        () => device.movePantoTo(1, new Vector(4, 5, 0)),
    ]);
});
// NEW: async / await syntax:
device.on('handleMoved', async (index, position) => {
    await device.movePantoTo(0, new Vector(1, 2, 0));
    await DualPantoFramework.waitMS(500);
    await device.movePantoTo(1, new Vector(4, 5, 0));
});
```

**Meta**

-   **deprecated**: **use async / await instead**


### waitMS

Generates a promise that creates a timeout.

**Parameters**

-   `ms` **[number][41]** number ob ms to wait.

**Examples**

```javascript
await broker.waitMS(500);
```

Returns **[Promise][43]** The promise executing the timeout.

**Meta**

-   **deprecated**: **use delay instead**


### devices

Iterator over all connected devices.

Type: Iterator&lt;[Device][40]>

**Examples**

```javascript
for(const device of broker.devices) {
    console.log(device);
}
```

## Device

**Extends EventEmitter**

Device represents a physical or virtual dual panto device.
A device is created by a broker when a physical device is connected
or when the visual debugger needs a virtual device.

**Parameters**

-   `broker` **[Broker][44]** the broker the device is created by
-   `port` **[string][39]** port on that the device is connected (or 'virtual<n>')
-   `isVirtual` **[boolean][45]** is this a virtual device

### send

Enqueues a packet to be send via the serial connection to the panto.

**Parameters**

-   `index` **[number][41]** index of handle to send to
-   `packet` **[Buffer][46]** containing the payload data

### getMePosition

gets the last known position of the me handle

Returns **[Vector][47]** last known position as vector

### getItPosition

gets the last known position of the it handle

Returns **[Vector][47]** last known position as vector

### createObstacle

Creates obstacles for handles

**Parameters**

-   `pointArray` **[array][42]** array containing edge points of the obstacle
-   `index` **[number][41]** index of affected handle with -1 meaning both (optional, default `-1`)

Returns **Obstacle** the created obstacle

### removeObstacle

Remove obstacles for handles

**Parameters**

-   `obstacle` **[array][42]** the obstacle to be removed
-   `index` **[number][41]** index of affected handle with -1 meaning both (optional, default `-1`)

### moveHandleTo

Moves a handle to a position.

**Parameters**

-   `index` **[number][41]** index of handle to move
-   `target` **[Vector][47]** position the handle should move to (optional, default `null`)

**Examples**

```javascript
device.moveHandleTo(0, new Vector(35, -50, 0));
```

### applyForceTo

Applies force vector to the pantograph.

**Parameters**

-   `index` **[number][41]** index of handle to apply force
-   `force` **[Vector][47]** vector of force to render (r component is ignored) (optional, default `null`)

**Examples**

```javascript
device.applyForceTo(0, new Vector(5, 7));
```

### movePantoTo

Moves a handle with tween movement behaviour.

**Parameters**

-   `index` **[number][41]** index of handle to move
-   `target` **[Vector][47]** position the handle should move to
-   `options` **[Object][37]?** movement options (optional, default `{}`)
    -   `options.duration` **[Object][37]?** time in ms that the movement should take
    -   `options.speed` **[Object][37]?** speed in units/second the movement should have
    -   `options.interpolationMethod` **[Object][37]?** tween function that is used to generate the movement
    -   `options.position` **[Object][37]?** the position that the movement should start from

**Examples**

```javascript
await device.movePantoTo(1, new Vector(24, -38, Math.PI/2));

// slow movement (1 second = 1000 milliseconds)
await device.movePantoTo(1, new Vector(24, -38, Math.PI/2), {duration: 1000});

// fast movement, with speed (100 = a distance of 50 should take 0.5 sec)
await device.movePantoTo(1, new Vector(-25, -38, Math.PI/2), {speed: 100});
```

### unblockHandle

Unblocks a handle. This enables free movement.

**Parameters**

-   `index` **[number][41]** index of handle to unblock

**Examples**

```javascript
await device.unblockHandle();
```

### step

Represents the timesteps for moving objects

### speakText

Speaks a text.

**Parameters**

-   `text` **[string][39]** the text to speak
-   `language` **[string][39]** the language to speak (optional, default `broker.defaultLanguage`)
-   `speed` **[number][41]** the speed that is spoken with (optional, default `broker.defaultSpeechSpeed`)

**Examples**

```javascript
await device.speakText('Hallo Welt!');
await device.speakText('Hello World', 'EN', 1.3);
```

### onKeyword

Works like device.on(...) but for keywords.

**Parameters**

-   `keyword` **[string][39]** the keyword to listen for
-   `handler` **[function][48]** the handler to execute when the keyword is recognized

**Examples**

```javascript
device.on('Hotels', showHotels);
```

Returns **[Device][40]** the device the method was called on

### onceKeyword

Works like device.once(...) but for keywords.
It is like onKeyword, but the handler gets called only once.

**Parameters**

-   `keyword` **[string][39]** the keyword to listen for
-   `handler` **[function][48]** the handler to execute when the keyword is recognized

**Examples**

```javascript
device.once('Shutdown', c);
```

Returns **[Device][40]** the device the method was called on

### offKeyword

Works like device.off(...) but for keywords.
It is like onKeyword, but the handler gets removed.

**Parameters**

-   `keyword` **[string][39]** the keyword to listen for
-   `handler` **[function][48]** the handler to execute when the keyword is recognized

**Examples**

```javascript
device.off('Hotels', showHotels);
```

Returns **[Device][40]** the device the method was called on

### emitKeyword

Works like device.emit(...) but for keywords.
Emits a keyword event.

**Parameters**

-   `keyword` **[string][39]** the keyword to listen for
-   `handler` **[function][48]** the handler to execute when the keyword is recognized

**Examples**

```javascript
device.emitKeyword('Hotel');
```

Returns **[Device][40]** the device the method was called on

## Player

Player is a class to control the playing of a file

**Parameters**

-   `filename` **[string][39]** The filename of the soundfile.

**Properties**

-   `isPlaying` **[boolean][45]** is the player currently playing

### then

The Player object is awaitable.
The then function is used internely by await or by the old `.then` syntax.

**Parameters**

-   `args` **...any** 

**Examples**

```javascript
await new Player('test.mp3');
// old syntax:
new Player('test.mp3').then(() => console.log('done'));
```

Returns **[Promise][43]** The promise of the state after the callbacks in then.

### play

Continue playing.

### pause

Pause playing.

### stop

Stop playing.

## VoiceInteraction

**Extends EventEmitter**

Class for voice input and output

**Parameters**

-   `broker` **[Broker][44]?** the asociated broker (optional, default `null`)

### speakText

Speaks a text.

**Parameters**

-   `text` **[string][39]** the text to speak
-   `language` **[string][39]** the language to speak (optional, default `DE`)
-   `speed` **[number][41]** the speed that is spoken with (optional, default `1.4`)

**Examples**

```javascript
await VoiceInteraction.speakText('Hallo Welt!');
await VoiceInteraction.speakText('Hello World', 'EN', 1.3);
```

### playSound

Play a soundfile.

**Parameters**

-   `filename` **[string][39]** The file to play.

Returns **[Player][49]** The player playing the sound

### setCommands

Sets up the voice input listener.

**Parameters**

-   `commands` **[array][42]** List of Strings to listen for.

**Examples**

```javascript
VoiceInteraction.setCommands(['Hotels']);
```

### beginListening

Starts the listener.

**Examples**

```javascript
VoiceInteraction.beginListening();
```

### haltListening

Stops the listener.

**Examples**

```javascript
VoiceInteraction.haltListening();
```

## util

All utility functions of the framework. These are exported directly on the framework.

**Examples**

```javascript
const {delay} = require('dualpantoframework');
// ...
await delay(500);
```

### delay

Creates a promise that resolves after a specified time.

**Parameters**

-   `time` **[number][41]** time to wait at least befor resolving

**Examples**

```javascript
await delay(500);
```

Returns **[Promise][43]** the promise

[1]: #dualpantoframework

[2]: #broker

[3]: #run_script

[4]: #waitms

[5]: #devices

[6]: #device

[7]: #send

[8]: #getmeposition

[9]: #getitposition

[10]: #createobstacle

[11]: #removeobstacle

[12]: #movehandleto

[13]: #applyforceto

[14]: #movepantoto

[15]: #unblockhandle

[16]: #step

[17]: #speaktext

[18]: #onkeyword

[19]: #oncekeyword

[20]: #offkeyword

[21]: #emitkeyword

[22]: #player

[23]: #then

[24]: #play

[25]: #pause

[26]: #stop

[27]: #voiceinteraction

[28]: #speaktext-1

[29]: #playsound

[30]: #setcommands

[31]: #beginlistening

[32]: #haltlistening

[33]: #util

[34]: #delay

[35]: geometry.md#geometry

[36]: geometry.md#vector

[37]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[38]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Map

[39]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[40]: #device

[41]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[42]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[43]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[44]: #broker

[45]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[46]: https://nodejs.org/api/buffer.html

[47]: geometry.md#vector

[48]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[49]: #player
