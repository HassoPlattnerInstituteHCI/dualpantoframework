# DualPanto Framework

This contains the API documentation of the main framework.

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [DualPantoFramework][1]
-   [Broker][2]
    -   [run_script][3]
    -   [waitMS][4]
    -   [devices][5]
-   [Device][6]
    -   [getPosition][7]
    -   [moveHandleTo][8]
    -   [applyForceTo][9]
    -   [movePantoTo][10]
    -   [unblockHandle][11]
    -   [speakText][12]
    -   [onKeyword][13]
    -   [onceKeyword][14]
    -   [offKeyword][15]
    -   [emitKeyword][16]
-   [VoiceInteraction][17]
    -   [speakText][18]
    -   [setCommands][19]
    -   [beginListening][20]
    -   [haltListening][21]
-   [util][22]
    -   [delay][23]

## DualPantoFramework

The dual panto framework. All classes and [utility][22] functions are exported.
This also includes the [geometry][24] classes (e.g. [Vector][25]).

**Examples**

```javascript
const {Broker, Vector, delay} = require('dualpantoframework');

const broker = new Broker();

broker.on('device', async device => {
    await delay(500);
    await device.movePantoTo(0, new Vector(20, -30, 0));
    await device.speakText('Hallo Welt!');
})
```

## Broker

**Extends EventEmitter**

Class for device handling and basic functions

**Parameters**

-   `options` **[Object][26]?** broker options (optional, default `{}`)

**Properties**

-   `devices` **[Map][27]&lt;[string][28], [Device][29]>** map of connected devices
-   `disconnectTimeout` **[number][30]** timeout after which a device gets disconnected

### run_script

Creates a script that executes a list of promises.

**Parameters**

-   `promiseList` **[array][31]** the list of promises to execute

**Examples**

```javascript
// OLD: run_script syntax:
device.on('handleMoved', (index, position) => {
    run_script([
        () => device.movePantoTo(0, new Vector(1, 2, 0)),
        () => DualPantoFramework.waitMS(500),
        () => device.movePantoTo(1, new Vector(4, 5, 0)),
    ]);
});
// NEW: async / await syntax:
device.on('handleMoved', async (index, position) => {
    await device.movePantoTo(0, new Vector(1, 2, 0));
    await DualPantoFramework.waitMS(500);
    await device.movePantoTo(1, new Vector(4, 5, 0));
});
```

**Meta**

-   **deprecated**: **use async / await instead**


### waitMS

Generates a promise that creates a timeout.

**Parameters**

-   `ms` **[number][30]** number ob ms to wait.

**Examples**

```javascript
await broker.waitMS(500);
```

Returns **[Promise][32]** The promise executing the timeout.

**Meta**

-   **deprecated**: **use delay instead**


### devices

Iterator over all connected devices.

Type: Iterator&lt;[Device][29]>

**Examples**

```javascript
for(const device of broker.devices) {
    console.log(device);
}
```

## Device

**Extends EventEmitter**

Device represents a physical or virtual dual panto device.
A device is created by a broker when a physical device is connected
or when the visual debugger needs a virtual device.

**Parameters**

-   `broker` **[Broker][33]** the broker the device is created by
-   `port` **[string][28]** port on that the device is connected (or 'virtual<n>')
-   `isVirtual` **[boolean][34]** is this a virtual device

### getPosition

Returns the current (or last known) position of the handle.

**Parameters**

-   `index` **[number][30]** index of handle

**Examples**

```javascript
// deprecated:
device.getPosition(0)
// new style:
device.meHandle.position
```

Returns **[Vector][35]** the position of the handle

**Meta**

-   **deprecated**: **Use [Handle#position][36] instead!**


### moveHandleTo

Moves a handle to a position.

**Parameters**

-   `index` **[number][30]** index of handle to move
-   `target` **[Vector][35]** position the handle should move to

**Examples**

```javascript
// deprecated:
device.moveHandleTo(0, new Vector(35, -50, 0));
// new style:
// pass 0 as the second argument to disable the animation
device.meHandle.moveTo(new Vector(35, -50, 0), 0);
```

**Meta**

-   **deprecated**: **Use [Handle#moveTo][37] instead!**


### applyForceTo

Applies force vector to the pantograph.

**Parameters**

-   `index` **[number][30]** index of handle to apply force
-   `force` **[Vector][35]** vector of force to render (r component is ignored)

**Examples**

```javascript
// deprecated:
device.applyForceTo(0, new Vector(5, 7));
// new style:
device.meHandle.applyForce(new Vector(5, 7));
```

**Meta**

-   **deprecated**: **Use [Handle#applyForce][38] instead!**


### movePantoTo

Moves a handle with tween movement behaviour.

**Parameters**

-   `index` **[number][30]** index of handle to move
-   `target` **[Vector][35]** position the handle should move to
-   `options` **[Object][26]?** movement options

**Examples**

```javascript
Deprecated
await device.movePantoTo(1, new Vector(24, -38, Math.PI/2));

// slow movement (1 second = 1000 milliseconds)
await device.movePantoTo(1, new Vector(24, -38, Math.PI/2), {duration: 1000});

// fast movement, with speed (100 = a distance of 50 should take 0.5 sec)
await device.movePantoTo(1, new Vector(-25, -38, Math.PI/2), {speed: 100});
```

```javascript
New Style
await device.itHandle.moveTo(new Vector(24, -38, Math.PI/2));

// slow movement (1 second = 1000 milliseconds)
await device.itHandle.moveTo(new Vector(24, -38, Math.PI/2), {duration: 1000});

// fast movement, with speed (100 = a distance of 50 should take 0.5 sec)
await device.itHandle.moveTo(new Vector(-25, -38, Math.PI/2), {speed: 100});
```

**Meta**

-   **deprecated**: **Use [Handle#moveTo][37] instead!**


### unblockHandle

Unblocks a handle. This enables free movement.

**Parameters**

-   `index` **[number][30]** index of handle to unblock

**Examples**

```javascript
// deprecated:
device.unblockHandle(0);
// new style:
device.meHandle.unblock();
```

**Meta**

-   **deprecated**: **Use [Handle#unblock][39] instead!**


### speakText

Speaks a text.

**Parameters**

-   `text` **[string][28]** the text to speak
-   `language` **[string][28]** the language to speak (optional, default `broker.defaultLanguage`)
-   `speed` **[number][30]** the speed that is spoken with (optional, default `broker.defaultSpeechSpeed`)

**Examples**

```javascript
await device.speakText('Hallo Welt!');
await device.speakText('Hello World', 'EN', 1.3);
```

### onKeyword

Works like device.on(...) but for keywords.

**Parameters**

-   `keyword` **[string][28]** the keyword to listen for
-   `handler` **[function][40]** the handler to execute when the keyword is recognized

**Examples**

```javascript
device.on('Hotels', showHotels);
```

Returns **[Device][29]** the device the method was called on

### onceKeyword

Works like device.once(...) but for keywords.
It is like onKeyword, but the handler gets called only once.

**Parameters**

-   `keyword` **[string][28]** the keyword to listen for
-   `handler` **[function][40]** the handler to execute when the keyword is recognized

**Examples**

```javascript
device.once('Shutdown', c);
```

Returns **[Device][29]** the device the method was called on

### offKeyword

Works like device.off(...) but for keywords.
It is like onKeyword, but the handler gets removed.

**Parameters**

-   `keyword` **[string][28]** the keyword to listen for
-   `handler` **[function][40]** the handler to execute when the keyword is recognized

**Examples**

```javascript
device.off('Hotels', showHotels);
```

Returns **[Device][29]** the device the method was called on

### emitKeyword

Works like device.emit(...) but for keywords.
Emits a keyword event.

**Parameters**

-   `keyword` **[string][28]** the keyword to listen for
-   `handler` **[function][40]** the handler to execute when the keyword is recognized

**Examples**

```javascript
device.emitKeyword('Hotel');
```

Returns **[Device][29]** the device the method was called on

## VoiceInteraction

**Extends EventEmitter**

Class for voice input and output

**Parameters**

-   `broker` **[Broker][33]?** the asociated broker (optional, default `null`)

### speakText

Speaks a text.

**Parameters**

-   `text` **[string][28]** the text to speak
-   `language` **[string][28]** the language to speak (optional, default `DE`)
-   `speed` **[number][30]** the speed that is spoken with (optional, default `1.4`)

**Examples**

```javascript
await VoiceInteraction.speakText('Hallo Welt!');
await VoiceInteraction.speakText('Hello World', 'EN', 1.3);
```

### setCommands

Sets up the voice input listener.

**Parameters**

-   `commands` **[array][31]** List of Strings to listen for.

**Examples**

```javascript
VoiceInteraction.setCommands(['Hotels']);
```

### beginListening

Starts the listener.

**Examples**

```javascript
VoiceInteraction.beginListening();
```

### haltListening

Stops the listener.

**Examples**

```javascript
VoiceInteraction.haltListening();
```

## util

All utility functions of the framework. These are exported directly on the framework.

**Examples**

```javascript
const {delay} = require('dualpantoframework');
// ...
await delay(500);
```

### delay

Creates a promise that resolves after a specified time.

**Parameters**

-   `time` **[number][30]** time to wait at least befor resolving

**Examples**

```javascript
await delay(500);
```

Returns **[Promise][32]** the promise

[1]: #dualpantoframework

[2]: #broker

[3]: #run_script

[4]: #waitms

[5]: #devices

[6]: #device

[7]: #getposition

[8]: #movehandleto

[9]: #applyforceto

[10]: #movepantoto

[11]: #unblockhandle

[12]: #speaktext

[13]: #onkeyword

[14]: #oncekeyword

[15]: #offkeyword

[16]: #emitkeyword

[17]: #voiceinteraction

[18]: #speaktext-1

[19]: #setcommands

[20]: #beginlistening

[21]: #haltlistening

[22]: #util

[23]: #delay

[24]: geometry.md#geometry

[25]: geometry.md#vector

[26]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[27]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Map

[28]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[29]: #device

[30]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[31]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[32]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[33]: #broker

[34]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[35]: geometry.md#vector

[36]: Handle#position

[37]: Handle#moveTo

[38]: Handle#applyForce

[39]: Handle#unblock

[40]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function
