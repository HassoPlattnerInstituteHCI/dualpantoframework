# DualPanto Framework

This contains the API documentation of the main framework.

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [DualPantoFramework][1]
-   [Broker][2]
    -   [run_script][3]
    -   [run_script][4]
    -   [waitMS][5]
    -   [waitMS][6]
    -   [devices][7]
    -   [devices][8]
-   [Broker][9]
    -   [run_script][10]
    -   [run_script][11]
    -   [waitMS][12]
    -   [waitMS][13]
    -   [devices][14]
    -   [devices][15]
-   [Device][16]
    -   [getPosition][17]
    -   [moveHandleTo][18]
    -   [applyForceTo][19]
    -   [movePantoTo][20]
    -   [unblockHandle][21]
    -   [speakText][22]
    -   [onKeyword][23]
    -   [onceKeyword][24]
    -   [offKeyword][25]
    -   [emitKeyword][26]
-   [VoiceInteraction][27]
    -   [speakText][28]
    -   [setCommands][29]
    -   [beginListening][30]
    -   [haltListening][31]
-   [util][32]
    -   [delay][33]

## DualPantoFramework

The dual panto framework. All classes and [utility][32] functions are exported.
This also includes the [geometry][34] classes (e.g. [Vector][35]).

**Examples**

```javascript
const {Broker, Vector, delay} = require('dualpantoframework');

const broker = new Broker();

broker.on('device', async device => {
    await delay(500);
    await device.movePantoTo(0, new Vector(20, -30, 0));
    await device.speakText('Hallo Welt!');
})
```

## Broker

**Extends EventEmitter**

Class for device handling and basic functions

**Parameters**

-   `options` **[Object][36]?** broker options (optional, default `{}`)

**Properties**

-   `devices` **[Map][37]&lt;[string][38], [Device][39]>** map of connected devices
-   `disconnectTimeout` **[number][40]** timeout after which a device gets disconnected

### run_script

Creates a script that executes a list of promises.

**Parameters**

-   `promiseList` **[array][41]** the list of promises to execute

**Examples**

```javascript
// OLD: run_script syntax:
device.on('handleMoved', (index, position) => {
    run_script([
        () => device.movePantoTo(0, new Vector(1, 2, 0)),
        () => DualPantoFramework.waitMS(500),
        () => device.movePantoTo(1, new Vector(4, 5, 0)),
    ]);
});
// NEW: async / await syntax:
device.on('handleMoved', async (index, position) => {
    await device.movePantoTo(0, new Vector(1, 2, 0));
    await DualPantoFramework.waitMS(500);
    await device.movePantoTo(1, new Vector(4, 5, 0));
});
```

**Meta**

-   **deprecated**: **use async / await instead**


### run_script

Creates a script that executes a list of promises.

**Parameters**

-   `promiseList` **[array][41]** the list of promises to execute

**Examples**

```javascript
// OLD: run_script syntax:
device.on('handleMoved', (index, position) => {
    run_script([
        () => device.movePantoTo(0, new Vector(1, 2, 0)),
        () => DualPantoFramework.waitMS(500),
        () => device.movePantoTo(1, new Vector(4, 5, 0)),
    ]);
});
// NEW: async / await syntax:
device.on('handleMoved', async (index, position) => {
    await device.movePantoTo(0, new Vector(1, 2, 0));
    await DualPantoFramework.waitMS(500);
    await device.movePantoTo(1, new Vector(4, 5, 0));
});
```

**Meta**

-   **deprecated**: **use async / await instead**


### waitMS

Generates a promise that creates a timeout.

**Parameters**

-   `ms` **[number][40]** number ob ms to wait.

**Examples**

```javascript
await broker.waitMS(500);
```

Returns **[Promise][42]** The promise executing the timeout.

**Meta**

-   **deprecated**: **use delay instead**


### waitMS

Generates a promise that creates a timeout.

**Parameters**

-   `ms` **[number][40]** number ob ms to wait.

**Examples**

```javascript
await broker.waitMS(500);
```

Returns **[Promise][42]** The promise executing the timeout.

**Meta**

-   **deprecated**: **use delay instead**


### devices

Iterator over all connected devices.

Type: Iterator&lt;[Device][39]>

**Examples**

```javascript
for(const device of broker.devices) {
    console.log(device);
}
```

### devices

Iterator over all connected devices.

Type: Iterator&lt;[Device][39]>

**Examples**

```javascript
for(const device of broker.devices) {
    console.log(device);
}
```

## Broker

**Extends EventEmitter**

Class for device handling and basic functions

**Parameters**

-   `options` **[Object][36]?** broker options (optional, default `{}`)

**Properties**

-   `devices` **[Map][37]&lt;[string][38], [Device][39]>** map of connected devices
-   `disconnectTimeout` **[number][40]** timeout after which a device gets disconnected

### run_script

Creates a script that executes a list of promises.

**Parameters**

-   `promiseList` **[array][41]** the list of promises to execute

**Examples**

```javascript
// OLD: run_script syntax:
device.on('handleMoved', (index, position) => {
    run_script([
        () => device.movePantoTo(0, new Vector(1, 2, 0)),
        () => DualPantoFramework.waitMS(500),
        () => device.movePantoTo(1, new Vector(4, 5, 0)),
    ]);
});
// NEW: async / await syntax:
device.on('handleMoved', async (index, position) => {
    await device.movePantoTo(0, new Vector(1, 2, 0));
    await DualPantoFramework.waitMS(500);
    await device.movePantoTo(1, new Vector(4, 5, 0));
});
```

**Meta**

-   **deprecated**: **use async / await instead**


### run_script

Creates a script that executes a list of promises.

**Parameters**

-   `promiseList` **[array][41]** the list of promises to execute

**Examples**

```javascript
// OLD: run_script syntax:
device.on('handleMoved', (index, position) => {
    run_script([
        () => device.movePantoTo(0, new Vector(1, 2, 0)),
        () => DualPantoFramework.waitMS(500),
        () => device.movePantoTo(1, new Vector(4, 5, 0)),
    ]);
});
// NEW: async / await syntax:
device.on('handleMoved', async (index, position) => {
    await device.movePantoTo(0, new Vector(1, 2, 0));
    await DualPantoFramework.waitMS(500);
    await device.movePantoTo(1, new Vector(4, 5, 0));
});
```

**Meta**

-   **deprecated**: **use async / await instead**


### waitMS

Generates a promise that creates a timeout.

**Parameters**

-   `ms` **[number][40]** number ob ms to wait.

**Examples**

```javascript
await broker.waitMS(500);
```

Returns **[Promise][42]** The promise executing the timeout.

**Meta**

-   **deprecated**: **use delay instead**


### waitMS

Generates a promise that creates a timeout.

**Parameters**

-   `ms` **[number][40]** number ob ms to wait.

**Examples**

```javascript
await broker.waitMS(500);
```

Returns **[Promise][42]** The promise executing the timeout.

**Meta**

-   **deprecated**: **use delay instead**


### devices

Iterator over all connected devices.

Type: Iterator&lt;[Device][39]>

**Examples**

```javascript
for(const device of broker.devices) {
    console.log(device);
}
```

### devices

Iterator over all connected devices.

Type: Iterator&lt;[Device][39]>

**Examples**

```javascript
for(const device of broker.devices) {
    console.log(device);
}
```

## Device

**Extends EventEmitter**

Device represents a physical or virtual dual panto device.
A device is created by a broker when a physical device is connected
or when the visual debugger needs a virtual device.

**Parameters**

-   `broker` **[Broker][43]** the broker the device is created by
-   `port` **[string][38]** port on that the device is connected (or 'virtual<n>')
-   `isVirtual` **[boolean][44]** is this a virtual device

### getPosition

Returns the current (or last known) position of the handle.

**Parameters**

-   `index` **[number][40]** index of handle

Returns **[Vector][45]** the position of the handle

### moveHandleTo

Moves a handle to a position.

**Parameters**

-   `index` **[number][40]** index of handle to move
-   `target` **[Vector][45]** position the handle should move to (optional, default `null`)

**Examples**

```javascript
device.moveHandleTo(0, new Vector(35, -50, 0));
```

### applyForceTo

Applies force vector to the pantograph.

**Parameters**

-   `index` **[number][40]** index of handle to apply force
-   `force` **[Vector][45]** vector of force to render (r component is ignored) (optional, default `null`)

**Examples**

```javascript
device.applyForceTo(0, new Vector(5, 7));
```

### movePantoTo

Moves a handle with tween movement behaviour.

**Parameters**

-   `index` **[number][40]** index of handle to move
-   `target` **[Vector][45]** position the handle should move to
-   `options` **[Object][36]?** movement options (optional, default `{}`)
    -   `options.duration` **[Object][36]?** time in ms that the movement should take
    -   `options.speed` **[Object][36]?** speed in units/second the movement should have
    -   `options.interpolationMethod` **[Object][36]?** tween function that is used to generate the movement
    -   `options.position` **[Object][36]?** the position that the movement should start from

**Examples**

```javascript
await device.movePantoTo(1, new Vector(24, -38, Math.PI/2));

// slow movement (1 second = 1000 milliseconds)
await device.movePantoTo(1, new Vector(24, -38, Math.PI/2), {duration: 1000});

// fast movement, with speed (100 = a distance of 50 should take 0.5 sec)
await device.movePantoTo(1, new Vector(-25, -38, Math.PI/2), {speed: 100});
```

### unblockHandle

Unblocks a handle. This enables free movement.

**Parameters**

-   `index` **[number][40]** index of handle to unblock

**Examples**

```javascript
await device.unblockHandle();
```

### speakText

Speaks a text.

**Parameters**

-   `text` **[string][38]** the text to speak
-   `language` **[string][38]** the language to speak (optional, default `broker.defaultLanguage`)
-   `speed` **[number][40]** the speed that is spoken with (optional, default `broker.defaultSpeechSpeed`)

**Examples**

```javascript
await device.speakText('Hallo Welt!');
await device.speakText('Hello World', 'EN', 1.3);
```

### onKeyword

Works like device.on(...) but for keywords.

**Parameters**

-   `keyword` **[string][38]** the keyword to listen for
-   `handler` **[function][46]** the handler to execute when the keyword is recognized

**Examples**

```javascript
device.on('Hotels', showHotels);
```

Returns **[Device][39]** the device the method was called on

### onceKeyword

Works like device.once(...) but for keywords.
It is like onKeyword, but the handler gets called only once.

**Parameters**

-   `keyword` **[string][38]** the keyword to listen for
-   `handler` **[function][46]** the handler to execute when the keyword is recognized

**Examples**

```javascript
device.once('Shutdown', c);
```

Returns **[Device][39]** the device the method was called on

### offKeyword

Works like device.off(...) but for keywords.
It is like onKeyword, but the handler gets removed.

**Parameters**

-   `keyword` **[string][38]** the keyword to listen for
-   `handler` **[function][46]** the handler to execute when the keyword is recognized

**Examples**

```javascript
device.off('Hotels', showHotels);
```

Returns **[Device][39]** the device the method was called on

### emitKeyword

Works like device.emit(...) but for keywords.
Emits a keyword event.

**Parameters**

-   `keyword` **[string][38]** the keyword to listen for
-   `handler` **[function][46]** the handler to execute when the keyword is recognized

**Examples**

```javascript
device.emitKeyword('Hotel');
```

Returns **[Device][39]** the device the method was called on

## VoiceInteraction

**Extends EventEmitter**

Class for voice input and output

**Parameters**

-   `broker` **[Broker][43]?** the asociated broker (optional, default `null`)

### speakText

Speaks a text.

**Parameters**

-   `text` **[string][38]** the text to speak
-   `language` **[string][38]** the language to speak (optional, default `DE`)
-   `speed` **[number][40]** the speed that is spoken with (optional, default `1.4`)

**Examples**

```javascript
await VoiceInteraction.speakText('Hallo Welt!');
await VoiceInteraction.speakText('Hello World', 'EN', 1.3);
```

### setCommands

Sets up the voice input listener.

**Parameters**

-   `commands` **[array][41]** List of Strings to listen for.

**Examples**

```javascript
VoiceInteraction.setCommands(['Hotels']);
```

### beginListening

Starts the listener.

**Examples**

```javascript
VoiceInteraction.beginListening();
```

### haltListening

Stops the listener.

**Examples**

```javascript
VoiceInteraction.haltListening();
```

## util

All utility functions of the framework. These are exported directly on the framework.

**Examples**

```javascript
const {delay} = require('dualpantoframework');
// ...
await delay(500);
```

### delay

Creates a promise that resolves after a specified time.

**Parameters**

-   `time` **[number][40]** time to wait at least befor resolving

**Examples**

```javascript
await delay(500);
```

Returns **[Promise][42]** the promise

[1]: #dualpantoframework

[2]: #broker

[3]: #run_script

[4]: #run_script-1

[5]: #waitms

[6]: #waitms-1

[7]: #devices

[8]: #devices-1

[9]: #broker-1

[10]: #run_script-2

[11]: #run_script-3

[12]: #waitms-2

[13]: #waitms-3

[14]: #devices-2

[15]: #devices-3

[16]: #device

[17]: #getposition

[18]: #movehandleto

[19]: #applyforceto

[20]: #movepantoto

[21]: #unblockhandle

[22]: #speaktext

[23]: #onkeyword

[24]: #oncekeyword

[25]: #offkeyword

[26]: #emitkeyword

[27]: #voiceinteraction

[28]: #speaktext-1

[29]: #setcommands

[30]: #beginlistening

[31]: #haltlistening

[32]: #util

[33]: #delay

[34]: geometry.md#geometry

[35]: geometry.md#vector

[36]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[37]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Map

[38]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[39]: #device

[40]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[41]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[42]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[43]: #broker

[44]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[45]: geometry.md#vector

[46]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function
