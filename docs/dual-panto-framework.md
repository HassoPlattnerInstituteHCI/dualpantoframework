# DualPanto Framework

This contains the API documentation of the main framework.

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [DualPantoFramework][1]
-   [Broker][2]
    -   [voiceInteraction][3]
    -   [run_script][4]
    -   [waitMS][5]
    -   [setCommands][6]
    -   [devices][7]
-   [Device][8]
    -   [getMePosition][9]
    -   [getItPosition][10]
    -   [createObstacle][11]
    -   [removeObstacle][12]
    -   [moveHandleTo][13]
    -   [applyForceTo][14]
    -   [movePantoTo][15]
    -   [unblockHandle][16]
    -   [speakText][17]
    -   [onKeyword][18]
    -   [onceKeyword][19]
    -   [offKeyword][20]
    -   [emitKeyword][21]
-   [Handle][22]
    -   [moveTo][23]
    -   [applyForce][24]
    -   [addObstacle][25]
    -   [setObstacles][26]
    -   [removeObstacle][27]
    -   [unblock][28]
-   [Player][29]
    -   [then][30]
    -   [play][31]
    -   [pause][32]
    -   [stop][33]
-   [VoiceInteraction][34]
    -   [speakText][35]
    -   [playSound][36]
    -   [setCommands][37]
    -   [beginListening][38]
    -   [haltListening][39]
-   [util][40]
    -   [delay][41]

## DualPantoFramework

The dual panto framework. All classes and [utility][40] functions are exported.
This also includes the [geometry][42] classes (e.g. [Vector][43]).

**Examples**

```javascript
const {Broker, Vector, delay} = require('dualpantoframework');

const broker = new Broker();

broker.on('device', async device => {
    await delay(500);
    await device.movePantoTo(0, new Vector(20, -30, 0));
    await device.speakText('Hello World!');
})
```

## Broker

**Extends EventEmitter**

Class for device handling and basic functions

**Parameters**

-   `options` **[Object][44]?** broker options (optional, default `{}`)
    -   `options.defaultSpeed` **[number][45]?** default speed for movements (overwrites duration)
    -   `options.defaultDuration` **[number][45]** default duration for movements (optional, default `500`)
    -   `options.defaultInterpolationMethod` **[Object][44]?** default interpolation method for movements
    -   `options.defaultLanguage` **[string][46]** default language for spoken text (optional, default `'DE'`)
    -   `options.defaultSpeechSpeed` **[number][45]** default speed for spoken text (optional, default `1.4`)
    -   `options.visualDebugger` **([Object][44] \| `false`)** visual debugger options (false = disable) (optional, default `{}`)
        -   `options.visualDebugger.port` **[number][45]** visual debugger port (optional, default `8080`)
    -   `options.deviceAutodetection` **bool** enable device autodetection (optional, default `true`)

**Properties**

-   `deviceMap` **[Map][47]&lt;[string][46], [Device][48]>** map of connected devices
-   `physicalDevices` **[Set][49]&lt;[Device][48]>** set of connected physical devices
-   `defaultSpeed` **[number][45]** default speed for movements (overwrites duration)
-   `defaultDuration` **[number][45]** default duration for movements
-   `defaultInterpolationMethod` **[Object][44]** default interpolation method for movements
-   `defaultLanguage` **[Object][44]** default language for spoken text
-   `defaultSpeechSpeed` **[Object][44]** default speed for spoken text

### voiceInteraction

Get the voice interaction instance. Only for compatibilaty reasons.

Type: [VoiceInteraction][50]

**Meta**

-   **deprecated**: **Use `device.speakText(text)` instead!**


### run_script

Creates a script that executes a list of promises.

**Parameters**

-   `promiseList` **[array][51]** the list of promises to execute

**Examples**

```javascript
// OLD: run_script syntax:
device.on('handleMoved', (index, position) => {
    run_script([
        () => device.movePantoTo(0, new Vector(1, 2, 0)),
        () => DualPantoFramework.waitMS(500),
        () => device.movePantoTo(1, new Vector(4, 5, 0)),
    ]);
});
// NEW: async / await syntax:
device.on('handleMoved', async (index, position) => {
    await device.movePantoTo(0, new Vector(1, 2, 0));
    await DualPantoFramework.waitMS(500);
    await device.movePantoTo(1, new Vector(4, 5, 0));
});
```

**Meta**

-   **deprecated**: **Use async / await instead!**


### waitMS

Generates a promise that creates a timeout.

**Parameters**

-   `ms` **[number][45]** number of milliseconds to wait

**Examples**

```javascript
// deprecated:
await broker.waitMS(500);
// new style:
const {delay} = require('dualpantoframework');
// ...
await delay(500);
```

**Meta**

-   **deprecated**: **Use `delay(ms)` instead!**


### setCommands

Set the list of commands to listen for and begin listening.

**Parameters**

-   `commands` **[Array][51]&lt;[string][46]>** the commands

### devices

Iterator over all connected devices.

Type: Iterator&lt;[Device][48]>

**Examples**

```javascript
for(const device of broker.devices) {
    console.log(device);
}
```

## Device

**Extends EventEmitter**

Device represents a physical or virtual dual panto device.
A device is created by a broker when a physical device is connected
or when the visual debugger needs a virtual device.
Normaly created by the [Broker][2].

**Parameters**

-   `broker` **[Broker][52]** the broker the device is created by
-   `port` **[string][46]** port on that the device is connected (or 'virtual<n>')
-   `isVirtual` **[boolean][53]** is this a virtual device (optional, default `false`)

**Properties**

-   `broker` **[Broker][52]** the broker the device is created by
-   `port` **[string][46]** port on that the device is connected (or 'virtual<n>')
-   `isVirtual` **[boolean][53]** is this a virtual device
-   `protocol` **Protocol?** the protocol to communicate with the device

### getMePosition

Gets the last known position of the me handle.

Returns **[Vector][54]** last known position

**Meta**

-   **deprecated**: **Use `device.meHandle.position` instead!**


### getItPosition

Gets the last known position of the it handle.

Returns **[Vector][54]** last known position

**Meta**

-   **deprecated**: **Use `device.itHandle.position` instead!**


### createObstacle

Creates obstacles for handles

**Parameters**

-   `obstacle` **([Polygon][55] \| [Array][51]&lt;[Vector][54]>)** the obstacle or array of vertices
-   `index` **[number][45]** index of affected handle with -1 meaning both (optional, default `-1`)

Returns **[Polygon][55]** the created obstacle

**Meta**

-   **deprecated**: **Use `handle.addObstacle(obstacle)` instead!**


### removeObstacle

Remove obstacles for handles

**Parameters**

-   `obstacle` **[Polygon][55]** the obstacle to be removed
-   `index` **[number][45]** index of affected handle with1 meaning both (optional, default `-1`)

**Meta**

-   **deprecated**: **Use `handle.removeObstacle(obstacle)` instead!**


### moveHandleTo

Moves a handle to a position.

**Parameters**

-   `index` **[number][45]** index of handle to move
-   `target` **[Vector][54]** position the handle should move to

**Examples**

```javascript
// deprecated:
device.moveHandleTo(0, new Vector(35, -50, 0));
// new style:
// pass 0 as the second argument to disable the animation
device.meHandle.moveTo(new Vector(35, -50, 0), 0);
```

**Meta**

-   **deprecated**: **Use `handle.moveTo(target, 0)` instead!**


### applyForceTo

Applies force vector to the pantograph.

**Parameters**

-   `index` **[number][45]** index of handle to apply force
-   `force` **[Vector][54]** vector of force to render (r component is ignored)

**Examples**

```javascript
// deprecated:
device.applyForceTo(0, new Vector(5, 7));
// new style:
device.meHandle.applyForce(new Vector(5, 7));
```

**Meta**

-   **deprecated**: **Use `handle.applyForce(force)` instead!**


### movePantoTo

Moves a handle with tween movement behaviour.

**Parameters**

-   `index` **[number][45]** index of handle to move
-   `target` **[Vector][54]** position the handle should be moved to
-   `options` **[Object][44]?** passed to moveTo

**Examples**

```javascript
Deprecated
await device.movePantoTo(1, new Vector(24, -38, Math.PI/2));

// slow movement (1 second = 1000 milliseconds)
await device.movePantoTo(1, new Vector(24, -38, Math.PI/2), {duration: 1000});

// fast movement, with speed (100 = a distance of 50 should take 0.5 sec)
await device.movePantoTo(1, new Vector(-25, -38, Math.PI/2), {speed: 100});
```

```javascript
New Style
await device.itHandle.moveTo(new Vector(24, -38, Math.PI/2));

// slow movement (1 second = 1000 milliseconds)
await device.itHandle.moveTo(new Vector(24, -38, Math.PI/2), {duration: 1000});

// fast movement, with speed (100 = a distance of 50 should take 0.5 sec)
await device.itHandle.moveTo(new Vector(-25, -38, Math.PI/2), {speed: 100});
```

**Meta**

-   **deprecated**: **Use `Handle.moveTo(target, options)` instead!**


### unblockHandle

Unblocks a handle. This enables free movement.

**Parameters**

-   `index` **[number][45]** index of handle to unblock

**Examples**

```javascript
// deprecated:
device.unblockHandle(0);
// new style:
device.meHandle.unblock();
```

**Meta**

-   **deprecated**: **Use `handle.unblock()` instead!**


### speakText

Speaks a text.

**Parameters**

-   `text` **[string][46]** the text to speak
-   `language` **[string][46]** the language to speak (optional, default `broker.defaultLanguage`)
-   `speed` **[number][45]** the speed that is spoken with (optional, default `broker.defaultSpeechSpeed`)

**Examples**

```javascript
await device.speakText('Hallo Welt!');
await device.speakText('Hello World', 'EN', 1.3);
```

### onKeyword

Works like device.on(...) but for keywords.

**Parameters**

-   `keyword` **[string][46]** the keyword to listen for
-   `handler` **[function][56]** the handler to execute when the keyword is recognized

**Examples**

```javascript
device.on('Hotels', showHotels);
```

Returns **[Device][48]** the device the method was called on

### onceKeyword

Works like device.once(...) but for keywords.
It is like onKeyword, but the handler gets called only once.

**Parameters**

-   `keyword` **[string][46]** the keyword to listen for
-   `handler` **[function][56]** the handler to execute when the keyword is recognized

**Examples**

```javascript
device.once('Shutdown', c);
```

Returns **[Device][48]** the device the method was called on

### offKeyword

Works like device.off(...) but for keywords.
It is like onKeyword, but the handler gets removed.

**Parameters**

-   `keyword` **[string][46]** the keyword to listen for
-   `handler` **[function][56]** the handler to execute when the keyword is recognized

**Examples**

```javascript
device.off('Hotels', showHotels);
```

Returns **[Device][48]** the device the method was called on

### emitKeyword

Works like device.emit(...) but for keywords.
Emits a keyword event.

**Parameters**

-   `keyword` **[string][46]** the keyword to listen for
-   `handler` **[function][56]** the handler to execute when the keyword is recognized

**Examples**

```javascript
device.emitKeyword('Hotel');
```

Returns **[Device][48]** the device the method was called on

## Handle

**Extends EventEmitter**

A single handle of a dual panto.

**Parameters**

-   `device` **[Device][48]** the device the handle is part of
-   `index` **[number][45]** the index number of the handle
-   `leftMotor` **Motor** the left motor
-   `rightMotor` **Motor** the right motor
-   `handleMotor` **Motor** the handle motor

**Properties**

-   `device` **[Device][48]** the device the handle is part of
-   `index` **[number][45]** the index number of the handle
-   `leftMotor` **Motor** the left motor
-   `rightMotor` **Motor** the right motor
-   `handleMotor` **Motor** the handle motor
-   `position` **[Vector][54]** the current position
-   `controller` **Controller** the current movement controller
-   `obstacles` **[Set][49]&lt;[Polygon][55]>** the current obstacles

### moveTo

Move the handle to a new position.
Calls [PositionController#moveTo][57].

**Parameters**

-   `position` **[Vector][54]** the position the handle should move to
-   `options` **[Object][44]** the movement options (optional, default `{}`)
    -   `options.speed` **[number][45]?** the movement speed (in units per millisecond) (overwrites duration)
    -   `options.duration` **[number][45]?** the movement duration (in milliseconds)
    -   `options.interpolationMethod` **[Object][44]?** the movement interpolation method
    -   `options.position` **[Vector][54]?** the start position of the movement

### applyForce

Apply a force to the handle.

**Parameters**

-   `force` **[Vector][54]** the force that should be apply

### addObstacle

Add an obstacle to the list of current obstacles.

**Parameters**

-   `obstacle` **[Polygon][55]** the new obstacle

### setObstacles

Set a new list of current obstacles.

**Parameters**

-   `obstacles` **[Array][51]&lt;[Polygon][55]>** the new obstacles

### removeObstacle

Remove an obstacle from the list of current obstacles.

**Parameters**

-   `obstacle` **[Polygon][55]** the obstacle to remove

### unblock

Unblock the handle. (i.e. allow free movement)

## Player

Player is a class to control the playing of a file.
It starts playing the file immidiatly.

**Parameters**

-   `filename` **[string][46]** The filename of the soundfile.

**Properties**

-   `isPlaying` **[boolean][53]** is the player currently playing

### then

The Player object is awaitable.
The then function is used internely by await or by the old `.then` syntax.

**Parameters**

-   `args` **...any** 

**Examples**

```javascript
await new Player('test.mp3');
// old syntax:
new Player('test.mp3').then(() => console.log('done'));
```

Returns **[Promise][58]** The promise of the state after the callbacks in then.

### play

Continue playing.

### pause

Pause playing.

### stop

Stop playing.

## VoiceInteraction

**Extends EventEmitter**

Class for voice input and output.

**Parameters**

-   `broker` **[Broker][52]?**  (optional, default `null`)

### speakText

Speaks a text.

**Parameters**

-   `text` **[string][46]** the text to speak
-   `language` **[string][46]** the language to speak (optional, default `DE`)
-   `speed` **[number][45]** the speed that is spoken with (optional, default `1.4`)

**Examples**

```javascript
await VoiceInteraction.speakText('Hallo Welt!');
await VoiceInteraction.speakText('Hello World', 'EN', 1.3);
```

### playSound

Play a soundfile.

**Parameters**

-   `filename` **[string][46]** The file to play.

Returns **[Player][59]** The player playing the sound

### setCommands

Sets up the voice input listener.

**Parameters**

-   `commands` **[array][51]** List of Strings to listen for.

**Examples**

```javascript
VoiceInteraction.setCommands(['Hotels']);
```

### beginListening

Starts the listener.

**Examples**

```javascript
VoiceInteraction.beginListening();
```

### haltListening

Stops the listener.

**Examples**

```javascript
VoiceInteraction.haltListening();
```

## util

All utility functions of the framework. These are exported directly on the framework.

**Examples**

```javascript
const {delay} = require('dualpantoframework');
// ...
await delay(500);
```

### delay

Creates a promise that resolves after a specified time.

**Parameters**

-   `time` **[number][45]** time to wait at least befor resolving

**Examples**

```javascript
await delay(500);
```

Returns **[Promise][58]** the promise

[1]: #dualpantoframework

[2]: #broker

[3]: #voiceinteraction

[4]: #run_script

[5]: #waitms

[6]: #setcommands

[7]: #devices

[8]: #device

[9]: #getmeposition

[10]: #getitposition

[11]: #createobstacle

[12]: #removeobstacle

[13]: #movehandleto

[14]: #applyforceto

[15]: #movepantoto

[16]: #unblockhandle

[17]: #speaktext

[18]: #onkeyword

[19]: #oncekeyword

[20]: #offkeyword

[21]: #emitkeyword

[22]: #handle

[23]: #moveto

[24]: #applyforce

[25]: #addobstacle

[26]: #setobstacles

[27]: #removeobstacle-1

[28]: #unblock

[29]: #player

[30]: #then

[31]: #play

[32]: #pause

[33]: #stop

[34]: #voiceinteraction-1

[35]: #speaktext-1

[36]: #playsound

[37]: #setcommands-1

[38]: #beginlistening

[39]: #haltlistening

[40]: #util

[41]: #delay

[42]: geometry.md#geometry

[43]: geometry.md#vector

[44]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[45]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[46]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[47]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Map

[48]: #device

[49]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Set

[50]: #voiceinteraction

[51]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[52]: #broker

[53]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[54]: geometry.md#vector

[55]: geometry.md#polygon

[56]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[57]: PositionController#moveTo

[58]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[59]: #player
