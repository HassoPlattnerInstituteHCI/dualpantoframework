# DualpantoFramework

[![CircleCI](https://circleci.com/gh/HassoPlattnerInstituteHCI/dualpantoframework.svg?style=svg&circle-token=32b766f8a9d2c9a0c612d215322a6dab4aec813d)](https://circleci.com/gh/HassoPlattnerInstituteHCI/dualpantoframework)

version 0.1

dev : Oliver Schneider, Jotaro Shigeyama, Alexander Meißner, Nico Böckhoff

firstname.lastname@hpi.de

## Installation & Setup

Welcome to the `dualpantoframework` repository!
This repository contains source codes for **reading and writing** signals to the dualpanto-board, as well as some useful tools to debug and test the pantograph.

In [this wiki page](https://github.com/HassoPlattnerInstituteHCI/dualpantoframework/wiki/Installation-&-Setup), we introduce you how to install the library in your system. Follow these steps to install required dependencies for `dualpantoframework`.

## Examples

...under construction...

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [DualPantoFramework](#dualpantoframework)
-   [Device](#device)
    -   [moveHandleTo](#movehandleto)
    -   [applyForceTo](#applyforceto)
    -   [movePantoTo](#movepantoto)
    -   [unblockHandle](#unblockhandle)
-   [Vector](#vector)
    -   [dot](#dot)
    -   [scale](#scale)
    -   [scaled](#scaled)
    -   [add](#add)
    -   [sum](#sum)
    -   [subtract](#subtract)
    -   [difference](#difference)
    -   [length](#length)
    -   [polarAngle](#polarangle)
    -   [normalized](#normalized)
    -   [product](#product)
-   [Broker](#broker)
    -   [run_script](#run_script)
    -   [waitMS](#waitms)
    -   [getDevices](#getdevices)
-   [VoiceInteraction](#voiceinteraction)
    -   [speakText](#speaktext)
    -   [setCommands](#setcommands)
    -   [beginListening](#beginlistening)
    -   [haltListening](#haltlistening)

### DualPantoFramework

The shared broker.

Type: [Broker](#broker)

**Parameters**

-   `voiceInteraction` **[VoiceInteraction](#voiceinteraction)** shared voice interaction instance

**Examples**

```javascript
const DualPantoFramework = require('dualpantoframework');
const VoiceInteraction = DualPantoFramework.voiceInteraction;
```

### Device

**Extends EventEmitter**

Class for panto interaction.

**Parameters**

-   `port` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** port on that the device is connected.

#### moveHandleTo

moves a Handle to a position

**Parameters**

-   `index` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** index of handle to move
-   `target` **[Vector](#vector)** position the handle should be moved to

**Examples**

```javascript
device.moveHandleTo(0, new Vector(35, -50, 0));
```

#### applyForceTo

applies force vector to the pantograph

**Parameters**

-   `index` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** index of handle to apply force
-   `force` **[Vector](#vector)** vector of force to render. 3rd element will be ignored.

**Examples**

```javascript
device.applyForceTo(0, new Vector(5, 7));
```

#### movePantoTo

Returns a promise that invokes handle movement with tween behaviour

**Parameters**

-   `index` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** index of handle to move
-   `target` **[Vector](#vector)** position the handle should be moved to
-   `duration` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** time in ms that the movement shall take. (optional, default `500`)
-   `interpolationMethod` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** tween function that is used to generate the movement. (optional, default `TWEEN.Easing.Quadratic.Out`)

**Examples**

```javascript
await device.movePantoTo(1, new Vector(24, -38, Math.PI/2));

// slow moevement (1 second = 1000 milliseconds)
await device.movePantoTo(1, new Vector(24, -38, Math.PI/2), 1000);
```

Returns **[promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** the promise executing the movement

#### unblockHandle

Returns a promise that unblocks a handle

**Parameters**

-   `index` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** index of handle to unblock

**Examples**

```javascript
await device.unblockHandle();
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** the promise executing the unblock

### Vector

Class for Class for defining Panto Vecotrs with x, y cords and r as roation

**Parameters**

-   `x` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** x coordinate (optional, default `0`)
-   `y` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** y coordinate (optional, default `0`)
-   `r` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** rotation in radian

#### dot

Calculates and returns the dot product with another vector.

**Parameters**

-   `vector` **[Vector](#vector)** vector to operate with

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The calculated result

#### scale

Scales this Vector with a factor.

**Parameters**

-   `factor` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** factor to scale vector

Returns **[Vector](#vector)** The scaled Vector

#### scaled

Creates a scaled vector.

**Parameters**

-   `factor` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** factor to scale vector

Returns **[Vector](#vector)** The new scaled Vector

#### add

Adds a vector to this vector.

**Parameters**

-   `vector` **[Vector](#vector)** vector to operate with

Returns **[Vector](#vector)** The summed up vector

#### sum

Returns the sum of this vector and another vector.

**Parameters**

-   `vector` **[Vector](#vector)** vector to operate with

Returns **[Vector](#vector)** The new summed up vector

#### subtract

Subtracts a vector from this vector.

**Parameters**

-   `vector` **[Vector](#vector)** vector to operate with

Returns **[Vector](#vector)** The reduced vector

#### difference

Returns the difference of this vector and another vector.

**Parameters**

-   `vector` **[Vector](#vector)** vector to operate with

Returns **[Vector](#vector)** The difference vector

#### length

Calculates the length of the vector

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** length of vector

#### polarAngle

Calculates the polar angle of the vector
Right-hand coordinate system:
Positive rotation => Counter Clock Wise
Positive X-Axis is 0

Returns **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** polar angle of vector

#### normalized

Normalizes the vector

Returns **[Vector](#vector)** this normalized vector

#### product

Creates a transformed vector by multiplication with a matrix

**Parameters**

-   `matrix` **[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** matrix to operate with

Returns **[Vector](#vector)** The transfromed vector

### Broker

**Extends EventEmitter**

Class for device handling and basic functions

**Properties**

-   `devices` **[Map](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Map)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), [Device](#device)>** map of connected devices
-   `disconnectTimeout` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** timeout after which a device gets disconnected

#### run_script

Creates a script that executes a list of promises.

**Parameters**

-   `promise_list` **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** the list of promises to execute.

**Examples**

```javascript
// OLD: run_script syntax:
device.on('handleMoved', (index, position) => {
    run_script([
        () => device.movePantoTo(0, new Vector(1, 2, 0)),
        () => DualPantoFramework.waitMS(500),
        () => device.movePantoTo(1, new Vector(4, 5, 0)),
    ]);
});
// NEW: async / await syntax:
device.on('handleMoved', async (index, position) => {
    await device.movePantoTo(0, new Vector(1, 2, 0));
    await DualPantoFramework.waitMS(500);
    await device.movePantoTo(1, new Vector(4, 5, 0));
});
```

**Meta**

-   **deprecated**: **use async / await instead**


#### waitMS

Generates a promise that creates a timeout.

**Parameters**

-   `ms` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** number ob ms to wait.

**Examples**

```javascript
await DualPantoFramework.waitMS(500);
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** The promise executing the timeout.

#### getDevices

Returns all connected devices.

**Examples**

```javascript
for(const device of DualPantoFramework.getDevices()) {
    console.log(device);
}
```

Returns **[Set](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Set)** The connected devices.

### VoiceInteraction

**Extends EventEmitter**

Class for voice input and output

#### speakText

Speaks a text.

**Parameters**

-   `txt` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** The text to speak.
-   `language` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** The language to speak. (optional, default `DE`)
-   `speed` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The speed that is spoken with. (optional, default `1.4`)

**Examples**

```javascript
await VoiceInteraction.speakText('Hallo Welt!');
await VoiceInteraction.speakText('Hello World', 'EN', 1.3);
```

Returns **[undefined](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined)** Currenlty nothing is returned

#### setCommands

Sets up the voice input listener.

**Parameters**

-   `commands` **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)** List of Strings to listen for.

**Examples**

```javascript
VoiceInteraction.setCommands(['Hotels']);
```

#### beginListening

starts the listener.

**Examples**

```javascript
await VoiceInteraction.beginListening();
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** An already resolved promise

#### haltListening

stops the listener.

**Examples**

```javascript
await VoiceInteraction.haltListening();
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** An already resolved promise
